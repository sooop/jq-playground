// jq built-in functions and operators
export const JQ_FUNCTIONS = [
  // Basic filters
  { name: '.', desc: 'Identity filter' },
  { name: '..', desc: 'Recursive descent' },
  { name: '.[]', desc: 'Array/object value iterator' },
  { name: '.foo', desc: 'Object field access' },

  // Types
  { name: 'type', desc: 'Get value type' },
  { name: 'length', desc: 'Get length of value' },
  { name: 'keys', desc: 'Get object keys or array indices' },
  { name: 'keys_unsorted', desc: 'Get keys without sorting' },
  { name: 'values', desc: 'Get all values' },
  { name: 'empty', desc: 'Return no results' },
  { name: 'null', desc: 'Null value' },

  // Array operations
  { name: 'map', desc: 'Map expression over array' },
  { name: 'select', desc: 'Filter by condition' },
  { name: 'sort', desc: 'Sort array' },
  { name: 'sort_by', desc: 'Sort by expression' },
  { name: 'reverse', desc: 'Reverse array' },
  { name: 'unique', desc: 'Get unique values' },
  { name: 'unique_by', desc: 'Get unique values by expression' },
  { name: 'group_by', desc: 'Group by expression' },
  { name: 'flatten', desc: 'Flatten array' },
  { name: 'add', desc: 'Add/concatenate array elements' },
  { name: 'min', desc: 'Get minimum value' },
  { name: 'max', desc: 'Get maximum value' },
  { name: 'min_by', desc: 'Get minimum by expression' },
  { name: 'max_by', desc: 'Get maximum by expression' },
  { name: 'first', desc: 'Get first element' },
  { name: 'last', desc: 'Get last element' },
  { name: 'nth', desc: 'Get nth element' },
  { name: 'indices', desc: 'Get indices of value' },
  { name: 'index', desc: 'Get first index of value' },
  { name: 'rindex', desc: 'Get last index of value' },
  { name: 'inside', desc: 'Check if inside another value' },
  { name: 'contains', desc: 'Check if contains value' },
  { name: 'has', desc: 'Check if has key' },
  { name: 'in', desc: 'Check if key is in object' },
  { name: 'any', desc: 'Check if any element matches' },
  { name: 'all', desc: 'Check if all elements match' },
  { name: 'limit', desc: 'Limit number of outputs' },
  { name: 'until', desc: 'Repeat until condition' },
  { name: 'while', desc: 'Repeat while condition' },
  { name: 'repeat', desc: 'Repeat expression' },
  { name: 'range', desc: 'Generate range of numbers' },
  { name: 'recurse', desc: 'Recursive application' },
  { name: 'walk', desc: 'Walk through structure' },
  { name: 'transpose', desc: 'Transpose matrix' },

  // String operations
  { name: 'tostring', desc: 'Convert to string' },
  { name: 'tonumber', desc: 'Convert to number' },
  { name: 'ascii_downcase', desc: 'Convert to lowercase' },
  { name: 'ascii_upcase', desc: 'Convert to uppercase' },
  { name: 'startswith', desc: 'Check if starts with string' },
  { name: 'endswith', desc: 'Check if ends with string' },
  { name: 'ltrimstr', desc: 'Remove prefix string' },
  { name: 'rtrimstr', desc: 'Remove suffix string' },
  { name: 'split', desc: 'Split string' },
  { name: 'join', desc: 'Join array to string' },
  { name: 'test', desc: 'Test regex match' },
  { name: 'match', desc: 'Match regex' },
  { name: 'capture', desc: 'Capture regex groups' },
  { name: 'splits', desc: 'Split by regex' },
  { name: 'sub', desc: 'Substitute first regex match' },
  { name: 'gsub', desc: 'Substitute all regex matches' },
  { name: 'implode', desc: 'Convert codepoints to string' },
  { name: 'explode', desc: 'Convert string to codepoints' },

  // Math operations
  { name: 'floor', desc: 'Round down to integer' },
  { name: 'ceil', desc: 'Round up to integer' },
  { name: 'round', desc: 'Round to nearest integer' },
  { name: 'sqrt', desc: 'Square root' },
  { name: 'pow', desc: 'Power' },
  { name: 'log', desc: 'Natural logarithm' },
  { name: 'log10', desc: 'Base-10 logarithm' },
  { name: 'log2', desc: 'Base-2 logarithm' },
  { name: 'exp', desc: 'Exponential' },
  { name: 'exp10', desc: 'Base-10 exponential' },
  { name: 'exp2', desc: 'Base-2 exponential' },
  { name: 'sin', desc: 'Sine' },
  { name: 'cos', desc: 'Cosine' },
  { name: 'tan', desc: 'Tangent' },
  { name: 'asin', desc: 'Arcsine' },
  { name: 'acos', desc: 'Arccosine' },
  { name: 'atan', desc: 'Arctangent' },
  { name: 'fabs', desc: 'Absolute value' },

  // Object operations
  { name: 'to_entries', desc: 'Convert object to key-value pairs' },
  { name: 'from_entries', desc: 'Convert key-value pairs to object' },
  { name: 'with_entries', desc: 'Transform object entries' },
  { name: 'paths', desc: 'Get all paths' },
  { name: 'leaf_paths', desc: 'Get paths to leaf values' },
  { name: 'getpath', desc: 'Get value at path' },
  { name: 'setpath', desc: 'Set value at path' },
  { name: 'delpaths', desc: 'Delete paths' },

  // Date operations
  { name: 'now', desc: 'Current Unix timestamp' },
  { name: 'fromdateiso8601', desc: 'Parse ISO8601 date' },
  { name: 'todateiso8601', desc: 'Format as ISO8601 date' },
  { name: 'fromdate', desc: 'Parse Unix timestamp' },
  { name: 'todate', desc: 'Format Unix timestamp' },
  { name: 'strftime', desc: 'Format time string' },
  { name: 'strptime', desc: 'Parse time string' },
  { name: 'gmtime', desc: 'Convert to GMT time array' },
  { name: 'mktime', desc: 'Convert time array to timestamp' },

  // I/O and formatting
  { name: 'format', desc: 'Format string' },
  { name: '@base64', desc: 'Base64 encode' },
  { name: '@base64d', desc: 'Base64 decode' },
  { name: '@uri', desc: 'URI encode' },
  { name: '@csv', desc: 'CSV format' },
  { name: '@tsv', desc: 'TSV format' },
  { name: '@json', desc: 'JSON format' },
  { name: '@html', desc: 'HTML encode' },
  { name: '@text', desc: 'Plain text format' },
  { name: '@sh', desc: 'Shell escape' },

  // Control flow
  { name: 'if', desc: 'Conditional expression' },
  { name: 'then', desc: 'Then branch' },
  { name: 'else', desc: 'Else branch' },
  { name: 'elif', desc: 'Else-if branch' },
  { name: 'end', desc: 'End conditional' },
  { name: 'and', desc: 'Logical AND' },
  { name: 'or', desc: 'Logical OR' },
  { name: 'not', desc: 'Logical NOT' },
  { name: 'try', desc: 'Try expression' },
  { name: 'catch', desc: 'Catch error' },

  // Special
  { name: 'error', desc: 'Raise error' },
  { name: 'debug', desc: 'Debug output' },
  { name: 'env', desc: 'Environment variables' },
  { name: '$__loc__', desc: 'Location info' },
  { name: 'input', desc: 'Read next input' },
  { name: 'inputs', desc: 'Read all inputs' },
  { name: 'recurse_down', desc: 'Recursive descent' },
  { name: 'isnan', desc: 'Check if NaN' },
  { name: 'isinfinite', desc: 'Check if infinite' },
  { name: 'isfinite', desc: 'Check if finite' },
  { name: 'isnormal', desc: 'Check if normal' },
  { name: 'infinite', desc: 'Infinite value' },
  { name: 'nan', desc: 'NaN value' },

  // Advanced
  { name: 'path', desc: 'Get path to value' },
  { name: 'del', desc: 'Delete path' },
  { name: 'reduce', desc: 'Reduce expression' },
  { name: 'foreach', desc: 'Foreach loop' },
  { name: 'as', desc: 'Bind variable' },
  { name: 'def', desc: 'Define function' },
  { name: 'ascii', desc: 'ASCII value' },
  { name: 'utf8bytelength', desc: 'UTF-8 byte length' },
  { name: 'tojson', desc: 'Convert to JSON string' },
  { name: 'fromjson', desc: 'Parse JSON string' },
  { name: 'splits', desc: 'Split stream' },
  { name: 'scan', desc: 'Scan for regex matches' },
  { name: 'combinations', desc: 'Get combinations' },
  { name: 'until', desc: 'Until loop' },
  { name: 'limit', desc: 'Limit output' },
  { name: 'sql', desc: 'SQL-like operations' },
  { name: 'builtins', desc: 'List all builtin functions' },

  // Null/Boolean handling
  { name: 'null', desc: 'Null value' },
  { name: 'true', desc: 'Boolean true' },
  { name: 'false', desc: 'Boolean false' },
  { name: 'isvalid', desc: 'Check if valid' },
  { name: 'isnull', desc: 'Check if null' },
  { name: 'isboolean', desc: 'Check if boolean' },
  { name: 'isnumber', desc: 'Check if number' },
  { name: 'isstring', desc: 'Check if string' },
  { name: 'isarray', desc: 'Check if array' },
  { name: 'isobject', desc: 'Check if object' },
  { name: 'isempty', desc: 'Check if empty' },

  // Alternative operators
  { name: 'alternative', desc: 'Alternative operator //' },
  { name: 'optional', desc: 'Optional operator ?' },

  // Type filters
  { name: 'arrays', desc: 'Select only arrays' },
  { name: 'objects', desc: 'Select only objects' },
  { name: 'iterables', desc: 'Select only iterables' },
  { name: 'booleans', desc: 'Select only booleans' },
  { name: 'numbers', desc: 'Select only numbers' },
  { name: 'strings', desc: 'Select only strings' },
  { name: 'nulls', desc: 'Select only nulls' },
  { name: 'values', desc: 'Select only non-null values' },
  { name: 'scalars', desc: 'Select only scalar values' },
];

export function filterFunctions(prefix) {
  if (!prefix) return [];

  const lower = prefix.toLowerCase();
  return JQ_FUNCTIONS
    .filter(fn => fn.name.toLowerCase().startsWith(lower))
    .slice(0, 10); // Limit to 10 suggestions
}
